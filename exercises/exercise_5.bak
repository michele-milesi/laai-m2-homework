#lang gamble
(require math/number-theory)

; NOTE: the follwing one is a Church program, so it has to be executed with a Church interpreter

; POINT D
; definition of the possible outcomes
(define x '(red blue green black))
; definition of the probability for each outcome
(define x-weights '(0.5 0.05 0.4 0.05))

; equivalent definition of the x-weights
; (define x-weights '(5 0.5 4 0.5))

; definition of a model which represents the distribution given in the exercise
(define (model)
  (multinomial x x-weights))

; visualization of the results
(hist (repeat 10000 model))


; POINT E
;; define some variables and utility functions
(define letters '(a b c d e f g h i j k l m n o p q r s t u v w x y z) )
(define (vowel? letter) (if (member letter '(a e i o u y)) #t #f))
(define letter-probabilities (map (lambda (letter) (if (vowel? letter) 0.01 0.047)) letters))

(define (my-list-index needle haystack counter)
  (if (null? haystack)
      'error
      (if (equal? needle (first haystack))
          counter
          (my-list-index needle (rest haystack) (+ 1 counter)))))

(define (get-position letter) (my-list-index letter letters 1))

;; actually compute p(h | win)
(define distribution
  (enumeration-query
   (define my-letter (multinomial letters letter-probabilities))

   (define my-position (get-position my-letter))
   (define my-win-probability (/ 1.0 (* my-position my-position)))
   (define win? (if (equal? my-letter 'a) 
                    #t 
                    (flip my-win-probability)))

   ; query to get the probability P(h | win)
   my-letter

   ; query to get the probability P(vowel | win) and P(consonant | win)
   ; (if (vowel? my-letter) 'vowel 'consonant) 

   ;; condition
   win?
   ))

(barplot distribution)